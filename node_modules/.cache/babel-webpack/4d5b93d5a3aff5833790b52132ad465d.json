{"ast":null,"code":"\"use strict\";\n\nvar __extends = this && this.__extends || function (d, b) {\n  for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n\n  function __() {\n    this.constructor = d;\n  }\n\n  d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n};\n\nvar Subject_1 = require('../../Subject');\n\nvar Subscriber_1 = require('../../Subscriber');\n\nvar Observable_1 = require('../../Observable');\n\nvar Subscription_1 = require('../../Subscription');\n\nvar root_1 = require('../../util/root');\n\nvar ReplaySubject_1 = require('../../ReplaySubject');\n\nvar tryCatch_1 = require('../../util/tryCatch');\n\nvar errorObject_1 = require('../../util/errorObject');\n\nvar assign_1 = require('../../util/assign');\n/**\n * We need this JSDoc comment for affecting ESDoc.\n * @extends {Ignored}\n * @hide true\n */\n\n\nvar WebSocketSubject = function (_super) {\n  __extends(WebSocketSubject, _super);\n\n  function WebSocketSubject(urlConfigOrSource, destination) {\n    if (urlConfigOrSource instanceof Observable_1.Observable) {\n      _super.call(this, destination, urlConfigOrSource);\n    } else {\n      _super.call(this);\n\n      this.WebSocketCtor = root_1.root.WebSocket;\n      this._output = new Subject_1.Subject();\n\n      if (typeof urlConfigOrSource === 'string') {\n        this.url = urlConfigOrSource;\n      } else {\n        // WARNING: config object could override important members here.\n        assign_1.assign(this, urlConfigOrSource);\n      }\n\n      if (!this.WebSocketCtor) {\n        throw new Error('no WebSocket constructor can be found');\n      }\n\n      this.destination = new ReplaySubject_1.ReplaySubject();\n    }\n  }\n\n  WebSocketSubject.prototype.resultSelector = function (e) {\n    return JSON.parse(e.data);\n  };\n  /**\n   * Wrapper around the w3c-compatible WebSocket object provided by the browser.\n   *\n   * @example <caption>Wraps browser WebSocket</caption>\n   *\n   * let socket$ = Observable.webSocket('ws://localhost:8081');\n   *\n   * socket$.subscribe(\n   *    (msg) => console.log('message received: ' + msg),\n   *    (err) => console.log(err),\n   *    () => console.log('complete')\n   *  );\n   *\n   * socket$.next(JSON.stringify({ op: 'hello' }));\n   *\n   * @example <caption>Wraps WebSocket from nodejs-websocket (using node.js)</caption>\n   *\n   * import { w3cwebsocket } from 'websocket';\n   *\n   * let socket$ = Observable.webSocket({\n   *   url: 'ws://localhost:8081',\n   *   WebSocketCtor: w3cwebsocket\n   * });\n   *\n   * socket$.subscribe(\n   *    (msg) => console.log('message received: ' + msg),\n   *    (err) => console.log(err),\n   *    () => console.log('complete')\n   *  );\n   *\n   * socket$.next(JSON.stringify({ op: 'hello' }));\n   *\n   * @param {string | WebSocketSubjectConfig} urlConfigOrSource the source of the websocket as an url or a structure defining the websocket object\n   * @return {WebSocketSubject}\n   * @static true\n   * @name webSocket\n   * @owner Observable\n   */\n\n\n  WebSocketSubject.create = function (urlConfigOrSource) {\n    return new WebSocketSubject(urlConfigOrSource);\n  };\n\n  WebSocketSubject.prototype.lift = function (operator) {\n    var sock = new WebSocketSubject(this, this.destination);\n    sock.operator = operator;\n    return sock;\n  };\n\n  WebSocketSubject.prototype._resetState = function () {\n    this.socket = null;\n\n    if (!this.source) {\n      this.destination = new ReplaySubject_1.ReplaySubject();\n    }\n\n    this._output = new Subject_1.Subject();\n  }; // TODO: factor this out to be a proper Operator/Subscriber implementation and eliminate closures\n\n\n  WebSocketSubject.prototype.multiplex = function (subMsg, unsubMsg, messageFilter) {\n    var self = this;\n    return new Observable_1.Observable(function (observer) {\n      var result = tryCatch_1.tryCatch(subMsg)();\n\n      if (result === errorObject_1.errorObject) {\n        observer.error(errorObject_1.errorObject.e);\n      } else {\n        self.next(result);\n      }\n\n      var subscription = self.subscribe(function (x) {\n        var result = tryCatch_1.tryCatch(messageFilter)(x);\n\n        if (result === errorObject_1.errorObject) {\n          observer.error(errorObject_1.errorObject.e);\n        } else if (result) {\n          observer.next(x);\n        }\n      }, function (err) {\n        return observer.error(err);\n      }, function () {\n        return observer.complete();\n      });\n      return function () {\n        var result = tryCatch_1.tryCatch(unsubMsg)();\n\n        if (result === errorObject_1.errorObject) {\n          observer.error(errorObject_1.errorObject.e);\n        } else {\n          self.next(result);\n        }\n\n        subscription.unsubscribe();\n      };\n    });\n  };\n\n  WebSocketSubject.prototype._connectSocket = function () {\n    var _this = this;\n\n    var WebSocketCtor = this.WebSocketCtor;\n    var observer = this._output;\n    var socket = null;\n\n    try {\n      socket = this.protocol ? new WebSocketCtor(this.url, this.protocol) : new WebSocketCtor(this.url);\n      this.socket = socket;\n\n      if (this.binaryType) {\n        this.socket.binaryType = this.binaryType;\n      }\n    } catch (e) {\n      observer.error(e);\n      return;\n    }\n\n    var subscription = new Subscription_1.Subscription(function () {\n      _this.socket = null;\n\n      if (socket && socket.readyState === 1) {\n        socket.close();\n      }\n    });\n\n    socket.onopen = function (e) {\n      var openObserver = _this.openObserver;\n\n      if (openObserver) {\n        openObserver.next(e);\n      }\n\n      var queue = _this.destination;\n      _this.destination = Subscriber_1.Subscriber.create(function (x) {\n        return socket.readyState === 1 && socket.send(x);\n      }, function (e) {\n        var closingObserver = _this.closingObserver;\n\n        if (closingObserver) {\n          closingObserver.next(undefined);\n        }\n\n        if (e && e.code) {\n          socket.close(e.code, e.reason);\n        } else {\n          observer.error(new TypeError('WebSocketSubject.error must be called with an object with an error code, ' + 'and an optional reason: { code: number, reason: string }'));\n        }\n\n        _this._resetState();\n      }, function () {\n        var closingObserver = _this.closingObserver;\n\n        if (closingObserver) {\n          closingObserver.next(undefined);\n        }\n\n        socket.close();\n\n        _this._resetState();\n      });\n\n      if (queue && queue instanceof ReplaySubject_1.ReplaySubject) {\n        subscription.add(queue.subscribe(_this.destination));\n      }\n    };\n\n    socket.onerror = function (e) {\n      _this._resetState();\n\n      observer.error(e);\n    };\n\n    socket.onclose = function (e) {\n      _this._resetState();\n\n      var closeObserver = _this.closeObserver;\n\n      if (closeObserver) {\n        closeObserver.next(e);\n      }\n\n      if (e.wasClean) {\n        observer.complete();\n      } else {\n        observer.error(e);\n      }\n    };\n\n    socket.onmessage = function (e) {\n      var result = tryCatch_1.tryCatch(_this.resultSelector)(e);\n\n      if (result === errorObject_1.errorObject) {\n        observer.error(errorObject_1.errorObject.e);\n      } else {\n        observer.next(result);\n      }\n    };\n  };\n  /** @deprecated internal use only */\n\n\n  WebSocketSubject.prototype._subscribe = function (subscriber) {\n    var _this = this;\n\n    var source = this.source;\n\n    if (source) {\n      return source.subscribe(subscriber);\n    }\n\n    if (!this.socket) {\n      this._connectSocket();\n    }\n\n    var subscription = new Subscription_1.Subscription();\n    subscription.add(this._output.subscribe(subscriber));\n    subscription.add(function () {\n      var socket = _this.socket;\n\n      if (_this._output.observers.length === 0) {\n        if (socket && socket.readyState === 1) {\n          socket.close();\n        }\n\n        _this._resetState();\n      }\n    });\n    return subscription;\n  };\n\n  WebSocketSubject.prototype.unsubscribe = function () {\n    var _a = this,\n        source = _a.source,\n        socket = _a.socket;\n\n    if (socket && socket.readyState === 1) {\n      socket.close();\n\n      this._resetState();\n    }\n\n    _super.prototype.unsubscribe.call(this);\n\n    if (!source) {\n      this.destination = new ReplaySubject_1.ReplaySubject();\n    }\n  };\n\n  return WebSocketSubject;\n}(Subject_1.AnonymousSubject);\n\nexports.WebSocketSubject = WebSocketSubject; //# sourceMappingURL=WebSocketSubject.js.map","map":{"version":3,"sources":["/Users/nguyenlong/ProjectCompany/2nMart/websiteclient-2nmart.vn/node_modules/ng5-slider/node_modules/rxjs/observable/dom/WebSocketSubject.js"],"names":["__extends","d","b","p","hasOwnProperty","__","constructor","prototype","Object","create","Subject_1","require","Subscriber_1","Observable_1","Subscription_1","root_1","ReplaySubject_1","tryCatch_1","errorObject_1","assign_1","WebSocketSubject","_super","urlConfigOrSource","destination","Observable","call","WebSocketCtor","root","WebSocket","_output","Subject","url","assign","Error","ReplaySubject","resultSelector","e","JSON","parse","data","lift","operator","sock","_resetState","socket","source","multiplex","subMsg","unsubMsg","messageFilter","self","observer","result","tryCatch","errorObject","error","next","subscription","subscribe","x","err","complete","unsubscribe","_connectSocket","_this","protocol","binaryType","Subscription","readyState","close","onopen","openObserver","queue","Subscriber","send","closingObserver","undefined","code","reason","TypeError","add","onerror","onclose","closeObserver","wasClean","onmessage","_subscribe","subscriber","observers","length","_a","AnonymousSubject","exports"],"mappings":"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","sourcesContent":["\"use strict\";\nvar __extends = (this && this.__extends) || function (d, b) {\n    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    function __() { this.constructor = d; }\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n};\nvar Subject_1 = require('../../Subject');\nvar Subscriber_1 = require('../../Subscriber');\nvar Observable_1 = require('../../Observable');\nvar Subscription_1 = require('../../Subscription');\nvar root_1 = require('../../util/root');\nvar ReplaySubject_1 = require('../../ReplaySubject');\nvar tryCatch_1 = require('../../util/tryCatch');\nvar errorObject_1 = require('../../util/errorObject');\nvar assign_1 = require('../../util/assign');\n/**\n * We need this JSDoc comment for affecting ESDoc.\n * @extends {Ignored}\n * @hide true\n */\nvar WebSocketSubject = (function (_super) {\n    __extends(WebSocketSubject, _super);\n    function WebSocketSubject(urlConfigOrSource, destination) {\n        if (urlConfigOrSource instanceof Observable_1.Observable) {\n            _super.call(this, destination, urlConfigOrSource);\n        }\n        else {\n            _super.call(this);\n            this.WebSocketCtor = root_1.root.WebSocket;\n            this._output = new Subject_1.Subject();\n            if (typeof urlConfigOrSource === 'string') {\n                this.url = urlConfigOrSource;\n            }\n            else {\n                // WARNING: config object could override important members here.\n                assign_1.assign(this, urlConfigOrSource);\n            }\n            if (!this.WebSocketCtor) {\n                throw new Error('no WebSocket constructor can be found');\n            }\n            this.destination = new ReplaySubject_1.ReplaySubject();\n        }\n    }\n    WebSocketSubject.prototype.resultSelector = function (e) {\n        return JSON.parse(e.data);\n    };\n    /**\n     * Wrapper around the w3c-compatible WebSocket object provided by the browser.\n     *\n     * @example <caption>Wraps browser WebSocket</caption>\n     *\n     * let socket$ = Observable.webSocket('ws://localhost:8081');\n     *\n     * socket$.subscribe(\n     *    (msg) => console.log('message received: ' + msg),\n     *    (err) => console.log(err),\n     *    () => console.log('complete')\n     *  );\n     *\n     * socket$.next(JSON.stringify({ op: 'hello' }));\n     *\n     * @example <caption>Wraps WebSocket from nodejs-websocket (using node.js)</caption>\n     *\n     * import { w3cwebsocket } from 'websocket';\n     *\n     * let socket$ = Observable.webSocket({\n     *   url: 'ws://localhost:8081',\n     *   WebSocketCtor: w3cwebsocket\n     * });\n     *\n     * socket$.subscribe(\n     *    (msg) => console.log('message received: ' + msg),\n     *    (err) => console.log(err),\n     *    () => console.log('complete')\n     *  );\n     *\n     * socket$.next(JSON.stringify({ op: 'hello' }));\n     *\n     * @param {string | WebSocketSubjectConfig} urlConfigOrSource the source of the websocket as an url or a structure defining the websocket object\n     * @return {WebSocketSubject}\n     * @static true\n     * @name webSocket\n     * @owner Observable\n     */\n    WebSocketSubject.create = function (urlConfigOrSource) {\n        return new WebSocketSubject(urlConfigOrSource);\n    };\n    WebSocketSubject.prototype.lift = function (operator) {\n        var sock = new WebSocketSubject(this, this.destination);\n        sock.operator = operator;\n        return sock;\n    };\n    WebSocketSubject.prototype._resetState = function () {\n        this.socket = null;\n        if (!this.source) {\n            this.destination = new ReplaySubject_1.ReplaySubject();\n        }\n        this._output = new Subject_1.Subject();\n    };\n    // TODO: factor this out to be a proper Operator/Subscriber implementation and eliminate closures\n    WebSocketSubject.prototype.multiplex = function (subMsg, unsubMsg, messageFilter) {\n        var self = this;\n        return new Observable_1.Observable(function (observer) {\n            var result = tryCatch_1.tryCatch(subMsg)();\n            if (result === errorObject_1.errorObject) {\n                observer.error(errorObject_1.errorObject.e);\n            }\n            else {\n                self.next(result);\n            }\n            var subscription = self.subscribe(function (x) {\n                var result = tryCatch_1.tryCatch(messageFilter)(x);\n                if (result === errorObject_1.errorObject) {\n                    observer.error(errorObject_1.errorObject.e);\n                }\n                else if (result) {\n                    observer.next(x);\n                }\n            }, function (err) { return observer.error(err); }, function () { return observer.complete(); });\n            return function () {\n                var result = tryCatch_1.tryCatch(unsubMsg)();\n                if (result === errorObject_1.errorObject) {\n                    observer.error(errorObject_1.errorObject.e);\n                }\n                else {\n                    self.next(result);\n                }\n                subscription.unsubscribe();\n            };\n        });\n    };\n    WebSocketSubject.prototype._connectSocket = function () {\n        var _this = this;\n        var WebSocketCtor = this.WebSocketCtor;\n        var observer = this._output;\n        var socket = null;\n        try {\n            socket = this.protocol ?\n                new WebSocketCtor(this.url, this.protocol) :\n                new WebSocketCtor(this.url);\n            this.socket = socket;\n            if (this.binaryType) {\n                this.socket.binaryType = this.binaryType;\n            }\n        }\n        catch (e) {\n            observer.error(e);\n            return;\n        }\n        var subscription = new Subscription_1.Subscription(function () {\n            _this.socket = null;\n            if (socket && socket.readyState === 1) {\n                socket.close();\n            }\n        });\n        socket.onopen = function (e) {\n            var openObserver = _this.openObserver;\n            if (openObserver) {\n                openObserver.next(e);\n            }\n            var queue = _this.destination;\n            _this.destination = Subscriber_1.Subscriber.create(function (x) { return socket.readyState === 1 && socket.send(x); }, function (e) {\n                var closingObserver = _this.closingObserver;\n                if (closingObserver) {\n                    closingObserver.next(undefined);\n                }\n                if (e && e.code) {\n                    socket.close(e.code, e.reason);\n                }\n                else {\n                    observer.error(new TypeError('WebSocketSubject.error must be called with an object with an error code, ' +\n                        'and an optional reason: { code: number, reason: string }'));\n                }\n                _this._resetState();\n            }, function () {\n                var closingObserver = _this.closingObserver;\n                if (closingObserver) {\n                    closingObserver.next(undefined);\n                }\n                socket.close();\n                _this._resetState();\n            });\n            if (queue && queue instanceof ReplaySubject_1.ReplaySubject) {\n                subscription.add(queue.subscribe(_this.destination));\n            }\n        };\n        socket.onerror = function (e) {\n            _this._resetState();\n            observer.error(e);\n        };\n        socket.onclose = function (e) {\n            _this._resetState();\n            var closeObserver = _this.closeObserver;\n            if (closeObserver) {\n                closeObserver.next(e);\n            }\n            if (e.wasClean) {\n                observer.complete();\n            }\n            else {\n                observer.error(e);\n            }\n        };\n        socket.onmessage = function (e) {\n            var result = tryCatch_1.tryCatch(_this.resultSelector)(e);\n            if (result === errorObject_1.errorObject) {\n                observer.error(errorObject_1.errorObject.e);\n            }\n            else {\n                observer.next(result);\n            }\n        };\n    };\n    /** @deprecated internal use only */ WebSocketSubject.prototype._subscribe = function (subscriber) {\n        var _this = this;\n        var source = this.source;\n        if (source) {\n            return source.subscribe(subscriber);\n        }\n        if (!this.socket) {\n            this._connectSocket();\n        }\n        var subscription = new Subscription_1.Subscription();\n        subscription.add(this._output.subscribe(subscriber));\n        subscription.add(function () {\n            var socket = _this.socket;\n            if (_this._output.observers.length === 0) {\n                if (socket && socket.readyState === 1) {\n                    socket.close();\n                }\n                _this._resetState();\n            }\n        });\n        return subscription;\n    };\n    WebSocketSubject.prototype.unsubscribe = function () {\n        var _a = this, source = _a.source, socket = _a.socket;\n        if (socket && socket.readyState === 1) {\n            socket.close();\n            this._resetState();\n        }\n        _super.prototype.unsubscribe.call(this);\n        if (!source) {\n            this.destination = new ReplaySubject_1.ReplaySubject();\n        }\n    };\n    return WebSocketSubject;\n}(Subject_1.AnonymousSubject));\nexports.WebSocketSubject = WebSocketSubject;\n//# sourceMappingURL=WebSocketSubject.js.map"]},"metadata":{},"sourceType":"script"}